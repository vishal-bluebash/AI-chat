/*Copyright 2015 ONL SpA*/
function init(e){function o(t,l){t=removeDiacritics(t),t=t.toLowerCase();var g=/ el | los | me | la | las | un | unos | una | unas | y | unas /g;t=t.replace(g," "),t=t.replace("?","");var c=/¿|el |los |me |la |las |un |unos |una |unas |y |se |unas /g;c.test(t.substring(0,4))&&(t=t.replace(c,""));var u=t.split(" "),h=u.length;for(i=0;h>i;i++)u[i].length<4&&(u[i]=0===i?u[i]+" ":i===h?" "+u[i]:" "+u[i]+" ");var d=[],v=[],p=[];e.forEach(function(e){var o=1;e.Pregunta=removeDiacritics(e.Pregunta),e.Pregunta=e.Pregunta.toLowerCase(),e.Pregunta=e.Pregunta.replace(g," "),c.test(e.Pregunta.substring(0,4))&&(e.Pregunta=e.Pregunta.replace(c,"")),e.Pregunta=e.Pregunta.replace("?","");var t=e.Pregunta.split(" "),n=t.length+h;for(i=0;h>i;i++)o=e.Pregunta.indexOf(u[i])>-1?2*o/n:u[i].length>5&&a(u[i],t)>=.7?o*(1+Math.pow(a(u[i],t),2))/n:1*o/n;d.push(o),v.push(e.Respuesta);var r=o*Math.pow(n,h);p.push(Math.log(r)/(Math.log(2)*(n/2)))}),void 0!==l&&(console.log("HOla"),console.log(h),l.forEach(function(e,o){p[o]=p[o]+e}));var f=d.indexOf(Math.max.apply(Math,d));console.log(p[f]),console.log(v[f]),console.log(h),console.log(t),p[f]>.49&&s!==f?(s=f,$("#chat_div").chatbox("option","boxManager").addMsg("Rosa",v[f]),r||(n=t)):n&&!r?(r=n,n=t,o(t,p)):($("#chat_div").chatbox("option","boxManager").addMsg("Rosa","No tengo la información necesaria para responderle por favor use el formulario de contacto"),r||(n=t))}function a(e,o){for(var a=o.length,n=e.length,r=[],i=0;a>i;i++)r.push(t(e,o[i]));return 1-d3.min(r)/n}function t(e,o){var a,t,n=[],r=e.length,i=o.length,s=function(e,o,a){var t=e;return t>o&&(t=o),t>a&&(t=a),t};if(0!=r&&0!=i){for(var a=0;r>=a;a++)n[a]=[];for(a=0;r>=a;a++)n[a][0]=a;for(t=0;i>=t;t++)n[0][t]=t;for(a=1;r>=a;a++){var l=e.charAt(a-1);for(t=1;i>=t;t++){var g=o.charAt(t-1);n[a][t]=l==g?n[a-1][t-1]:1+s(n[a-1][t-1],n[a][t-1],n[a-1][t])}}return n[r][i]}}var n=0,r=0,s=0;$(document).ready(function(){function e(){a?(console.log("hola"),a.chatbox("option","boxManager").toggleBox()):(console.log("hola"),a=$("#chat_div").chatbox({id:"Yo",user:{key:"value"},title:"Servicio al Cliente",messageSent:function(e,a,t){$("#chat_div").chatbox("option","boxManager").addMsg(e,t),setTimeout(o,2500,t),r=0}}),$("#chat_div").chatbox("option","boxManager").addMsg("Rosa","Buenos días. ¿Como está el día de hoy?\n¿Le puedo ayudar en algo?"))}var a=null;null===sessionStorage.getItem("key")?setTimeout(e,600):(console.log(sessionStorage.getItem("key")),a=$("#chat_div").chatbox({id:"Yo",user:{key:"value"},title:"Servicio al Cliente",messageSent:function(e,a,t){$("#chat_div").chatbox("option","boxManager").addMsg(e,t),setTimeout(o,2500,t)}}),$("#chat_div").chatbox("option","boxManager").addMsg("Yo",sessionStorage.getItem("key")),$("#chat_div").chatbox("option","boxManager").addMsg("Rosa",sessionStorage.getItem("response")),sessionStorage.clear())})}
