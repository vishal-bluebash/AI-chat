/*Copyright 2015 ONL SpA*/
function init(){var o=["productos","contacto","ubicacion","empresa","blanco","rojo","rosado","amarillo","bicolor","gerbera","gladiolo"];d3.tsv("faqc.csv",function(e,a){function t(o,e){o=removeDiacritics(o),o=o.toLowerCase();var r=/ el | los | me | la | las | un | unos | una | unas | y | unas /g;o=o.replace(r," "),o=o.replace("?","");var g=/¿|el |los |me |la |las |un |unos |una |unas |y |se |unas /g;g.test(o.substring(0,4))&&(o=o.replace(g,""));var u=o.split(" "),h=u.length;for(i=0;h>i;i++)u[i].length<4&&(u[i]=0===i?u[i]+" ":i===h?" "+u[i]:" "+u[i]+" ");var d=[],v=[],f=[];a.forEach(function(o){var e=1;o.Pregunta=removeDiacritics(o.Pregunta),o.Pregunta=o.Pregunta.toLowerCase(),o.Pregunta=o.Pregunta.replace(r," "),g.test(o.Pregunta.substring(0,4))&&(o.Pregunta=o.Pregunta.replace(g,"")),o.Pregunta=o.Pregunta.replace("?","");var a=o.Pregunta.split(" "),t=a.length+h;for(i=0;h>i;i++)e=o.Pregunta.indexOf(u[i])>-1?2*e/t:u[i].length>5&&n(u[i],a)>=.7?e*(1+Math.pow(n(u[i],a),2))/t:1*e/t;d.push(e),v.push(o.Respuesta);var s=e*Math.pow(t,h);f.push(Math.log(s)/(Math.log(2)*(t/2)))}),void 0!==e&&(console.log("HOla"),console.log(h),e.forEach(function(o,e){f[e]=f[e]+o}));var p=d.indexOf(Math.max.apply(Math,d));console.log(f[p]),console.log(v[p]),console.log(h),console.log(o),f[p]>.49&&c!==p?(c=p,$("#chat_div").chatbox("option","boxManager").addMsg("Rosa",v[p]),l||(s=o)):s&&!l?(l=s,s=o,t(o,f)):($("#chat_div").chatbox("option","boxManager").addMsg("Rosa","No tengo la información necesaria para responderle por favor use el formulario de contacto"),l||(s=o))}function n(o,e){for(var a=e.length,t=o.length,n=[],i=0;a>i;i++)n.push(r(o,e[i]));return 1-d3.min(n)/t}function r(o,e){var a,t,n=[],i=o.length,r=e.length,s=function(o,e,a){var t=o;return t>e&&(t=e),t>a&&(t=a),t};if(0!=i&&0!=r){for(var a=0;i>=a;a++)n[a]=[];for(a=0;i>=a;a++)n[a][0]=a;for(t=0;r>=t;t++)n[0][t]=t;for(a=1;i>=a;a++){var l=o.charAt(a-1);for(t=1;r>=t;t++){var c=e.charAt(t-1);n[a][t]=l==c?n[a-1][t-1]:1+s(n[a-1][t-1],n[a][t-1],n[a-1][t])}}return n[i][r]}}var s=0,l=0,c=0;$(document).ready(function(){function e(){a?(console.log("hola"),a.chatbox("option","boxManager").toggleBox()):(console.log("hola"),a=$("#chat_div").chatbox({id:"Yo",user:{key:"value"},title:"Servicio al Cliente",messageSent:function(e,a,n){$("#chat_div").chatbox("option","boxManager").addMsg(e,n);var r;for(i=0;i<o.length;i++){var s=n.split(" ");for(console.log("listo"),j=0;j<s.length;j++)s[j].indexOf(o[i])>-1&&(r=o[i]+".html")}void 0!==r&&window.location.href.indexOf(r)<0?(sessionStorage.setItem("key",n),sessionStorage.setItem("response","La respuesta"),window.location.href=r):(console.log("listo1"),setTimeout(t,2500,n),l=0)}}),$("#chat_div").chatbox("option","boxManager").addMsg("Rosa","Buenos días. ¿Como está el día de hoy?\n¿Le puedo ayudar en algo?"))}var a=null;null===sessionStorage.getItem("key")?setTimeout(e,600):(console.log(sessionStorage.getItem("key")),a=$("#chat_div").chatbox({id:"Yo",user:{key:"value"},title:"Servicio al Cliente",messageSent:function(e,a,n){$("#chat_div").chatbox("option","boxManager").addMsg(e,n);var r;for(i=0;i<o.length;i++){var s=n.split(" ");for(console.log("listo"),j=0;j<s.length;j++)s[j].indexOf(o[i])>-1&&(r=o[i]+".html")}void 0!==r&&window.location.href.indexOf(r)<0?(sessionStorage.setItem("key",n),window.location.href=r):(console.log("listo1"),setTimeout(t,2500,n))}}),$("#chat_div").chatbox("option","hidden",!1),$("#chat_div").chatbox("option","boxManager").addMsg("Yo",sessionStorage.getItem("key")),t(sessionStorage.getItem("key")),sessionStorage.clear())})})}
